!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("svg-path-utils")):"function"==typeof define&&define.amd?define(["exports","d3-selection","svg-path-utils"],e):e(t.yarrow=t.yarrow||{},t.d3,t.svg_path_utils)}(this,function(t,e,n){"use strict";function r(){var t=this.selection;t.attrs||(t.prototype.attrs=function(t){for(var e in t)this.attr(e,t[e]);return this},t.prototype.styles=function(t,e){for(var n in t)this.style(n,t[n],e);return this})}var i=function(){var t={};r.apply(e);var n=[];return t.arrow=function(t,e){e=e||document.body;var r=new o(this,t,e);return n.push(r),r},t.arrows=function(t,e){if(!arguments.length)return n;e=e||document.body;var r=this;return t.forEach(function(t){n.push(new o(r,t,e))}),this},t.remove=function(t){for(var e=-1,r=n.length;e++<r;)if(n[e].id===t)return n.splice(e,1)},t.renderAll=function(){return n.forEach(function(t){t.render()}),this},t.disposeAll=function(){var t=n.slice();return t.forEach(function(t){t.dispose()}),this},t},o=function(t,r,i){function o(t,e){function n(t){for(var e=0,n=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{top:n,left:e}}var r=t.getBoundingClientRect(),i=r.right-r.left,o=r.bottom-r.top,s=n(t),a=n(e),u=s.top-a.top,l=s.left-a.left;return{element:t,top:u,left:l,width:i,height:o,bottom:u+o,right:l+i,centerX:l+i/2,centerY:u+i/2}}function s(){"function"==typeof r.x1&&(f.x1=r.x1(f)),"function"==typeof r.y1&&(f.y1=r.y1(f)),"function"==typeof r.x2&&(f.x2=r.x2(f)),"function"==typeof r.y2&&(f.y2=r.y2(f))}var a={},u=new n.SVGPathUtils,l="id"+Math.random().toString(36).substr(2,10),d=e.select(i),f={};f={animation:"undefined"==typeof r.animation||r.animation,x1:r.x1||0,y1:r.y1||0,x2:r.x2||0,y2:r.y2||0,d:r.d||function(t,e){return e.join(e.M(t.dx>0?0:t.w,t.dy>0?0:t.h),e.L(t.dx>0?t.dx:0,t.dy>0?t.dy:0))},d1:r.d1||function(t,e){return e.join(e.m(0,0),e.l(-20,-10))},d2:r.d2||function(t,e){return e.join(e.m(0,0),e.l(-20,10))},arrowStyles:r.arrowStyles||{},text:r.text,textDx:r.textDx||0,textDy:r.textDy||-5,textStyles:r.textStyles||{},margin:Object.assign({},{top:20,right:20,bottom:20,left:20},r.margin),get dx(){return this.x2-this.x1},get dy(){return this.y2-this.y1},get w(){return Math.abs(this.dx)},get h(){return Math.abs(this.dy)}};var c;return r.source&&(c=e.select(r.source).node())&&(f.source=o(c,i)),r.target&&(c=e.select(r.target).node())&&(f.target=o(c,i)),s(),f.duration=r.duration||300,f.delay=r.delay||0,f.duration1=r.duration1||200,f.delay1=r.delay1||f.duration+f.delay,f.duration2=r.duration2||f.duration1,f.delay2=r.delay2||f.duration+f.delay,f.textReverseDirection=("function"==typeof r.textReverseDirection?r.textReverseDirection(f,u):r.textReverseDirection)||!1,f.textStartOffset=("function"==typeof r.textStartOffset?r.textStartOffset(f,u):r.textStartOffset)||0,a.id=l,a.render=function(){var t,e=f.margin,n=f.w,r=f.h,i=Math.min(f.y1,f.y2)-e.top,o=Math.min(f.x1,f.x2)-e.left,s=n+e.left+e.right,a=r+e.top+e.bottom;d.select("#"+l).remove(),t=d.append("svg").attrs({id:l,"xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve",class:"yarrow",viewBox:"0 0 "+s+" "+a+" ",width:s+"px",height:a+"px"}).styles({top:i+"px",left:o+"px"});var c,y,h,x,p=t.append("g").attrs({transform:"translate("+e.left+","+e.top+")"}),g=p.append("path").attrs({id:"path_"+l,"stroke-linecap":"round","stroke-linejoin":"round",class:"arrow",d:"function"==typeof f.d?f.d(f,u):f.d}).styles(f.arrowStyles),v=g.node(),m="function"==typeof v.getTotalLength;m?(c=v.getTotalLength(),y=v.getPointAtLength(c-1),h=v.getPointAtLength(c)):(c=0,y={x:0,y:0},h={x:0,y:0}),x=u.angle(y,h),f.animation&&(g.styles({"animation-duration":f.duration/1e3+"s","animation-delay":f.delay/1e3+"s","stroke-dasharray":c+" "+c,"stroke-dashoffset":c,visibility:"hidden"}),setTimeout(function(){g.style("visibility","visible")},f.delay));var w=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round",class:"arrow tip-1",d:"function"==typeof f.d1?f.d1(f,u):f.d1,transform:"translate("+h.x+","+h.y+")rotate("+x+")"});if(f.animation){var b=m?w.node().getTotalLength():0;w.styles({"animation-duration":f.duration1/1e3+"s","animation-delay":f.delay1/1e3+"s","stroke-dasharray":b+" "+b,"stroke-dashoffset":b,visibility:"hidden"}),setTimeout(function(){w.style("visibility","visible")},f.delay1)}w.styles(f.arrowStyles);var S=p.append("path").attrs({"stroke-linecap":"round","stroke-linejoin":"round",class:"arrow tip-2",d:"function"==typeof f.d2?f.d2(f,u):f.d2,transform:"translate("+h.x+","+h.y+")rotate("+x+")"});if(f.animation){var D=m?S.node().getTotalLength():0;S.styles({"animation-duration":f.duration2/1e3+"s","animation-delay":f.delay2/1e3+"s","stroke-dasharray":D+" "+D,"stroke-dashoffset":D,visibility:"hidden"}),setTimeout(function(){S.style("visibility","visible")},f.delay2)}S.styles(f.arrowStyles),f.textReverseDirection&&p.append("path").attrs({id:"path_reverse_"+l,d:u.inversePath("function"==typeof f.d?f.d(f,u):f.d)}).style("display","none");var j=p.append("text").attrs({class:"arrow text",dx:f.textDx,dy:f.textDy}).styles(f.textStyles),O=j.append("textPath").attrs({"xlink:href":f.textReverseDirection?"#path_reverse_"+l:"#path_"+l,startOffset:f.textReverseDirection?c-f.textStartOffset:f.textStartOffset}).html(f.text);return f.animation&&(O.styles({opacity:0}),setTimeout(function(){O.styles({transition:"all "+f.duration/1e3+"s linear",opacity:1})},f.delay+10)),this},a.dispose=function(e,n){function r(t,e){return e?(t.selectAll(".arrow").styles({transition:"all "+e/1e3+"s linear",opacity:0}),void setTimeout(function(){return t.remove()},e)):t.remove()}var i=d.select("#"+l);t.remove(l),n?setTimeout(function(){r(i,e)},n):r(i,e)},a.options=function(t){if(!arguments.length)return f;for(var e in t)f.hasOwnProperty(e)&&(f[e]=t[e]);return this},a.x1=function(t){return arguments.length?(f.x1=t,this):f.x1},a.y1=function(t){return arguments.length?(f.y1=t,this):f.y1},a.x2=function(t){return arguments.length?(f.x2=t,this):f.x2},a.y2=function(t){return arguments.length?(f.y2=t,this):f.y2},a.source=function(t){return arguments.length?(f.source=t,s(),this):f.source},a.target=function(t){return arguments.length?(f.target=t,s(),this):f.target},a.duration=function(t){return arguments.length?(f.duration=t,this):f.duration},a.delay=function(t){return arguments.length?(f.delay=t,this):f.delay},a.d=function(t){return arguments.length?(f.d=t,this):f.d},a.duration1=function(t){return arguments.length?(f.duration1=t,this):f.duration1},a.delay1=function(t){return arguments.length?(f.delay1=t,this):f.delay1},a.d1=function(t){return arguments.length?(f.d1=t,this):f.d1},a.duration2=function(t){return arguments.length?(f.duration2=t,this):f.duration2},a.delay2=function(t){return arguments.length?(f.delay2=t,this):f.delay2},a.d2=function(t){return arguments.length?(f.d1=t,this):f.d1},a.arrowStyles=function(t){return arguments.length?(f.arrowStyles=t,this):f.arrowStyles},a.text=function(t){return arguments.length?(f.text=t,this):f.text},a.textReverseDirection=function(t){return arguments.length?(f.textReverseDirection=t,this):f.textReverseDirection},a.textStartOffset=function(t){return arguments.length?(f.textStartOffset=t,this):f.textStartOffset},a.textDx=function(t){return arguments.length?(f.textDx=t,this):f.textDx},a.textDy=function(t){return arguments.length?(f.textDy=t,this):f.textDy},a.textStyles=function(t){return arguments.length?(f.textStyles=t,this):f.textStyles},a.margin=function(t){return arguments.length?(f.margin=Object.assign({},f.margin,t),this):f.margin},a};t.Yarrow=i});